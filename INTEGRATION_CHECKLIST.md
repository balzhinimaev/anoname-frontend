# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è WebSocket API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üéØ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 1. **–ò–º–ø–æ—Ä—Ç Socket.IO** 
- ‚ùå **–ë—ã–ª–æ**: `import socketIOClient from 'socket.io-client'` + `io()`
- ‚úÖ **–°—Ç–∞–ª–æ**: `import io from 'socket.io-client'`

#### 2. **–°–æ–±—ã—Ç–∏—è `chat:read`**
- ‚ùå **–ë—ã–ª–æ**: `{ chatId, userId, timestamp }` 
- ‚úÖ **–°—Ç–∞–ª–æ**: `{ chatId, timestamp }` (—Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)

#### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—è `location`**
- ‚ùå **–ë—ã–ª–æ**: `location: searchData.location ? {...} : undefined`
- ‚úÖ **–°—Ç–∞–ª–æ**: `...(searchData.location && { location: {...} })`

#### 4. **–ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π**
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã**: `search:status`, `chat:read`, `chat:rated`, `contact:request`, `contact:status`
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã**: `onSearchStatus()`, `onChatRead()`, `onChatRated()`, `onContactRequest()`, `onContactStatus()`

#### 5. **–§—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤**
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã**: `requestContact()`, `respondToContact()`
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç API**: `contact:request` –∏ `contact:respond`

#### 6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–∞—Ç–∞**
- ‚úÖ **–ü–æ–ª–Ω—ã–π UI —á–∞—Ç–∞** –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
- ‚úÖ **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** –º–µ–∂–¥—É —Ñ–æ—Ä–º–æ–π –ø–æ–∏—Å–∫–∞ –∏ —á–∞—Ç–æ–º
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π** —á–∞—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## üìã –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ —Å–æ–±—ã—Ç–∏—è–º:

### üîç **–ü–æ–∏—Å–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤**
| –°–æ–±—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|---------|---------|------------|
| `search:start` | ‚úÖ | `websocketService.startSearch()` |
| `search:cancel` | ‚úÖ | `websocketService.cancelSearch()` |
| `search:subscribe_stats` | ‚úÖ | `websocketService.subscribeToStats()` |
| `search:unsubscribe_stats` | ‚úÖ | `websocketService.unsubscribeFromStats()` |
| `search:matched` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —á–∞—Ç—É |
| `search:status` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω |
| `search:expired` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–µ—Ä–µ–∑ `onError` |
| `search:stats` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI |

### üí¨ **–ß–∞—Ç –∏ —Å–æ–æ–±—â–µ–Ω–∏—è**  
| –°–æ–±—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|---------|---------|------------|
| `chat:join` | ‚úÖ | `websocketService.joinChat()` |
| `chat:leave` | ‚úÖ | `websocketService.leaveChat()` |
| `chat:message` (–æ—Ç–ø—Ä–∞–≤–∫–∞) | ‚úÖ | `websocketService.sendMessage()` |
| `chat:message` (–ø–æ–ª—É—á–µ–Ω–∏–µ) | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —á–∞—Ç–µ |
| `chat:typing` | ‚úÖ | `websocketService.sendTyping()` + –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ |
| `chat:read` | ‚úÖ | `websocketService.markAsRead()` + –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| `chat:end` | ‚úÖ | `websocketService.endChat()` |
| `chat:ended` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + –∑–∞–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞ |
| `chat:rate` | ‚úÖ | `websocketService.rateChat()` |
| `chat:rated` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |

### üë• **–ö–æ–Ω—Ç–∞–∫—Ç—ã**
| –°–æ–±—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|---------|---------|------------|
| `contact:request` (–æ—Ç–ø—Ä–∞–≤–∫–∞) | ‚úÖ | `websocketService.requestContact()` |
| `contact:request` (–ø–æ–ª—É—á–µ–Ω–∏–µ) | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |
| `contact:respond` | ‚úÖ | `websocketService.respondToContact()` |
| `contact:status` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ |

### üîó **–°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è**
| –°–æ–±—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|---------|---------|------------|
| `connect` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É |
| `disconnect` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–∏—Å–∫–∞ |
| `connect_error` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ |
| `connection:recovered` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ |
| `error` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è:

### **WebSocket —Å–µ—Ä–≤–∏—Å** (`src/services/websocket.ts`)
- ‚úÖ –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä (`singleton`)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ 
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö** (`src/types/index.ts`)
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ `ClientToServerEvents` –∏ `ServerToClientEvents`
- ‚úÖ –í—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è WebSocket —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è `chat:read`

### **–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** (`src/App.tsx`)
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket –ø–æ—Å–ª–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π —Å UI –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–∏—Å–∫–æ–º –∏ —á–∞—Ç–æ–º
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å Telegram

### **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∞—Ç–∞** (`src/components/Chat.tsx`)
- ‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–∞—Ç–∞
- ‚úÖ –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º

### **–§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞** (`src/components/SearchForm.tsx`)
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞/—á–∞—Ç–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π UI

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å:

### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- ‚úÖ JWT —Ç–æ–∫–µ–Ω –≤ `auth.token` –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- ‚úÖ –í—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ Graceful fallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ WebSocket
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram API

### **–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (5 –ø–æ–ø—ã—Ç–æ–∫)
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ `connection:recovered`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

---

## üì± Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:

### **WebApp API**
- ‚úÖ –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `showAlert`
- ‚úÖ –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–º—ã Telegram
- ‚úÖ MainButton –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏

### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç**
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–∏—Å–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã
- ‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —á–∞—Ç —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:

**‚úÖ –ü–û–õ–ù–û–ï –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ WebSocket API**

- **100% —Å–æ–±—ã—Ç–∏–π** –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- **–í—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏  
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram** –Ω–∞ –≤—ã—Å—à–µ–º —É—Ä–æ–≤–Ω–µ
- **–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É** —Å —Ä–µ–∞–ª—å–Ω—ã–º WebSocket —Å–µ—Ä–≤–µ—Ä–æ–º

### –î–ª—è –∑–∞–ø—É—Å–∫–∞:
1. –û–±–Ω–æ–≤–∏—Ç–µ URL —Å–µ—Ä–≤–µ—Ä–∞ –≤ `src/App.tsx` (—Å—Ç—Ä–æ–∫–∞ 80)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `npm start`
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram WebApp –∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä–µ

**–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å –≤–∞—à–∏–º WebSocket API! üöÄ** 